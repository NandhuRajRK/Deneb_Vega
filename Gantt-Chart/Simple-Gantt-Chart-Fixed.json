{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "Simple Program Project Gantt Chart - Fixed Timeline",
  "autosize": "pad",
  "width": 1400,
  "padding": {"left": 5, "right": 0, "top": 5, "bottom": 0},
  "signals": [
    {"name": "height", "update": "600"},
    {"name": "showTooltips", "value": true},
    {"name": "showTodayLine", "value": true},
    {"name": "textColour", "value": "#2c3e50"},
    {"name": "backgroundColor", "value": "#ffffff"},
    {"name": "gridColor", "value": "#ecf0f1"},
    {"name": "yRowHeight", "value": 45},
    {"name": "yRowPadding", "value": 0.12},
    {"name": "yPaddingInner", "update": "yRowPadding * yRowHeight"},
    {"name": "programColumnWidth", "value": 180},
    {"name": "projectColumnWidth", "value": 200},
    {"name": "managerColumnWidth", "value": 120},
    {"name": "g0DateColumnWidth", "value": 90},
    {"name": "g5DateColumnWidth", "value": 90},
    {"name": "columnPadding", "value": 15},
    {"name": "oneDay", "update": "1000*60*60*24"},
    {
      "name": "columnsWidth",
      "update": "programColumnWidth+projectColumnWidth+managerColumnWidth+g0DateColumnWidth+g5DateColumnWidth+(columnPadding*5)"
    },
    {"name": "ganttWidth", "update": "width-columnsWidth-30"},
    {
      "name": "today",
      "update": "+datetime(year(now()),month(now()),date(now()))"
    },
    {"name": "todayRule", "update": "timeFormat(today,'%d/%m/%y')"},
    {
      "name": "tooltip",
      "value": {},
      "on": [
        {"events": "@ganttBars:mouseover", "update": "datum"},
        {"events": "@ganttBars:mouseout", "update": "{}"}
      ]
    }
  ],
  "data": [
    {
      "name": "dataset",
      "values": [
        {
          "program": "Cloud Migration",
          "project": "AWS Infrastructure Setup",
          "projectManager": "Sarah Johnson",
          "g0Date": "01/03/2024",
          "g5Date": "15/06/2024",
          "projectStatus": "On Track"
        },
        {
          "program": "Cloud Migration", 
          "project": "Data Migration",
          "projectManager": "Mike Chen",
          "g0Date": "01/04/2024",
          "g5Date": "30/07/2024",
          "projectStatus": "At Risk"
        },
        {
          "program": "Cloud Migration",
          "project": "Application Modernization",
          "projectManager": "Lisa Rodriguez",
          "g0Date": "01/05/2024",
          "g5Date": "30/09/2024",
          "projectStatus": "Delayed"
        },
        {
          "program": "Security Enhancement",
          "project": "Zero Trust Implementation",
          "projectManager": "David Kim",
          "g0Date": "01/02/2024",
          "g5Date": "31/05/2024",
          "projectStatus": "Completed"
        },
        {
          "program": "Security Enhancement",
          "project": "SIEM Integration",
          "projectManager": "Alex Thompson",
          "g0Date": "01/06/2024",
          "g5Date": "31/10/2024",
          "projectStatus": "Not Started"
        }
      ],
      "transform": [
        {
          "type": "formula",
          "as": "g0DateParsed",
          "expr": "datetime(datum.g0Date)"
        },
        {
          "type": "formula", 
          "as": "g5DateParsed",
          "expr": "datetime(datum.g5Date)"
        },
        {
          "type": "formula",
          "as": "duration",
          "expr": "datum.g5DateParsed - datum.g0DateParsed"
        },
        {
          "type": "formula",
          "as": "g0Formatted",
          "expr": "timeFormat(datetime(datum.g0Date), '%d/%m/%Y')"
        },
        {
          "type": "formula",
          "as": "g5Formatted",
          "expr": "timeFormat(datetime(datum.g5Date), '%d/%m/%Y')"
        },
        {
          "type": "formula",
          "as": "durationDays",
          "expr": "round((datum.g5DateParsed - datum.g0DateParsed) / oneDay)"
        }
      ]
    }
  ],
  "scales": [
    {
      "name": "x",
      "type": "time",
      "domain": {"data": "dataset", "field": "g0DateParsed"},
      "range": [{"signal": "columnsWidth"}, {"signal": "width"}]
    },
    {
      "name": "y",
      "type": "band",
      "domain": {"data": "dataset", "field": "project"},
      "range": [0, {"signal": "data('dataset').length * yRowHeight"}],
      "padding": {"signal": "yPaddingInner"}
    },
    {
      "name": "color",
      "type": "ordinal",
      "domain": ["On Track", "At Risk", "Delayed", "Completed", "Not Started"],
      "range": ["#27ae60", "#f39c12", "#e74c3c", "#3498db", "#95a5a6"]
    },
    {
      "name": "programColor",
      "type": "ordinal",
      "domain": {"data": "dataset", "field": "program"},
      "range": "category"
    }
  ],
  "axes": [
    {
      "orient": "top",
      "scale": "x",
      "title": "Project Timeline",
      "titleColor": {"signal": "textColour"},
      "titleFontSize": 16,
      "titleFontWeight": "bold",
      "titlePadding": 15,
      "tickColor": {"signal": "gridColor"},
      "domainColor": {"signal": "gridColor"},
      "labelColor": {"signal": "textColour"},
      "labelFontSize": 12,
      "grid": true,
      "gridColor": {"signal": "gridColor"},
      "gridOpacity": 0.5
    }
  ],
  "marks": [
    {
      "type": "rect",
      "name": "background",
      "encode": {
        "enter": {
          "width": {"signal": "width"},
          "height": {"signal": "height"},
          "fill": {"signal": "backgroundColor"}
        }
      }
    },
    {
      "type": "rect",
      "name": "tableHeaders",
      "encode": {
        "enter": {
          "x": {"value": 0},
          "y": {"value": 0},
          "width": {"signal": "columnsWidth"},
          "height": {"value": 40},
          "fill": {"value": "#f8f9fa"},
          "stroke": {"signal": "gridColor"},
          "strokeWidth": {"value": 1}
        }
      }
    },
    {
      "type": "text",
      "name": "programHeader",
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "Program"},
          "fontSize": {"value": 13},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "projectHeader", 
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth + projectColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "Project"},
          "fontSize": {"value": 13},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "managerHeader",
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth + projectColumnWidth + managerColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "Manager"},
          "fontSize": {"value": 13},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "g0Header",
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "G0 Date"},
          "fontSize": {"value": 13},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "g5Header",
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth + g5DateColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "G5 Date"},
          "fontSize": {"value": 13},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "rect",
      "name": "rowBackgrounds",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "y": {"scale": "y", "field": "project"},
          "dy": {"value": 40},
          "height": {"signal": "yRowHeight"},
          "fill": {"value": "#ffffff"},
          "stroke": {"signal": "gridColor"},
          "strokeWidth": {"value": 0.5}
        }
      }
    },
    {
      "type": "text",
      "name": "programLabels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2 + 40"},
          "text": {"field": "program"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"scale": "programColor", "field": "program"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "projectLabels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth + projectColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2 + 40"},
          "text": {"field": "project"},
          "fontSize": {"value": 11},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "managerLabels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth + projectColumnWidth + managerColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2 + 40"},
          "text": {"field": "projectManager"},
          "fontSize": {"value": 11},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "g0Labels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2 + 40"},
          "text": {"field": "g0Formatted"},
          "fontSize": {"value": 10},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "g5Labels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth + g5DateColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2 + 40"},
          "text": {"field": "g5Formatted"},
          "fontSize": {"value": 10},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "rect",
      "name": "ganttBars",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"scale": "x", "field": "g0DateParsed"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yPaddingInner/2 + 40"},
          "height": {"signal": "yRowHeight - yPaddingInner"},
          "fill": {"scale": "color", "field": "projectStatus"},
          "stroke": {"signal": "textColour"},
          "strokeWidth": {"value": 1},
          "cornerRadius": {"value": 4},
          "cursor": {"value": "pointer"}
        },
        "update": {
          "width": {"scale": "x", "field": "duration"}
        }
      }
    },
    {
      "type": "rule",
      "name": "todayLine",
      "encode": {
        "enter": {
          "x": {"scale": "x", "signal": "today"},
          "y": {"value": 40},
          "y2": {"signal": "height"},
          "stroke": {"value": "#e74c3c"},
          "strokeWidth": {"value": 2},
          "strokeDash": {"value": [5, 5]},
          "opacity": {"signal": "showTodayLine ? 0.8 : 0"}
        }
      }
    },
    {
      "type": "text",
      "name": "todayLabel",
      "encode": {
        "enter": {
          "x": {"scale": "x", "signal": "today"},
          "y": {"value": 55},
          "text": {"signal": "'Today: ' + todayRule"},
          "fontSize": {"value": 11},
          "fill": {"value": "#e74c3c"},
          "textAnchor": {"value": "middle"},
          "opacity": {"signal": "showTodayLine ? 0.8 : 0"}
        }
      }
    }
  ]
} 