{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "Portfolio Program Project Gantt Chart - Vega Editor Version",
  "autosize": "pad",
  "width": 1400,
  "padding": {"left": 5, "right": 0, "top": 5, "bottom": 0},
  "signals": [
    {"name": "height", "update": "600"},
    {"name": "showTooltips", "value": true},
    {"name": "showButtons", "value": true},
    {"name": "showTodayLine", "value": true},
    {
      "name": "startGrain",
      "value": "Months",
      "description": "Days, Months, Years or All"
    },
    {"name": "textColour", "value": "#2c3e50"},
    {"name": "textColourLight", "value": "#7f8c8d"},
    {"name": "backgroundColor", "value": "#ffffff"},
    {"name": "gridColor", "value": "#ecf0f1"},
    {"name": "yRowHeight", "value": 40},
    {"name": "yRowPadding", "value": 0.15},
    {"name": "yPaddingInner", "update": "yRowPadding * yRowHeight"},
    {"name": "portfolioColumnWidth", "value": 120},
    {"name": "programColumnWidth", "value": 120},
    {"name": "projectColumnWidth", "value": 150},
    {"name": "managerColumnWidth", "value": 100},
    {"name": "g0DateColumnWidth", "value": 80},
    {"name": "g5DateColumnWidth", "value": 80},
    {"name": "prevG5DateColumnWidth", "value": 80},
    {"name": "statusColumnWidth", "value": 80},
    {"name": "columnPadding", "value": 12},
    {"name": "oneDay", "update": "1000*60*60*24"},
    {"name": "minDayBandwidth", "value": 25},
    {"name": "minMonthBandwidth", "value": 4},
    {"name": "minYearBandwidth", "value": 1.2},
    {
      "name": "columnsWidth",
      "update": "portfolioColumnWidth+programColumnWidth+projectColumnWidth+managerColumnWidth+g0DateColumnWidth+g5DateColumnWidth+prevG5DateColumnWidth+statusColumnWidth+(columnPadding*8)"
    },
    {"name": "ganttWidth", "update": "width-columnsWidth-minDayBandwidth"},
    {
      "name": "today",
      "update": "+datetime(year(now()),month(now()),date(now()))"
    },
    {"name": "todayRule", "update": "timeFormat(today,'%d/%m/%y')"},
    {
      "name": "zoom",
      "value": 1,
      "on": [
        {
          "events": "wheel!",
          "force": true,
          "update": "x()>columnsWidth?pow(1.001, (event.deltaY) * pow(16, event.deltaMode)):1"
        }
      ]
    },
    {
      "name": "xDom",
      "update": "[data('xExt')[0]['s']-oneDay,data('xExt')[0]['e']+oneDay*9]",
      "on": [
        {
          "events": "dblclick",
          "update": "[data('xExt')[0]['s']-oneDay,data('xExt')[0]['e']+oneDay*9]"
        }
      ]
    },
    {"name": "scaledHeight", "update": "data('yScale').length * yRowHeight"},
    {
      "name": "yRange",
      "update": "[0,scaledHeight]",
      "on": [
        {"events": "dblclick", "update": "[0,scaledHeight]"}
      ]
    }
  ],
  "data": [
    {
      "name": "dataset",
      "values": [
        {
          "portfolio": "Digital Transformation",
          "program": "Cloud Migration",
          "project": "AWS Infrastructure Setup",
          "projectManager": "Sarah Johnson",
          "g0Date": "01/03/2024",
          "g5Date": "15/06/2024",
          "prevG5Date": "01/06/2024",
          "projectStatus": "On Track"
        },
        {
          "portfolio": "Digital Transformation",
          "program": "Cloud Migration", 
          "project": "Data Migration",
          "projectManager": "Mike Chen",
          "g0Date": "01/04/2024",
          "g5Date": "30/07/2024",
          "prevG5Date": "15/07/2024",
          "projectStatus": "At Risk"
        },
        {
          "portfolio": "Digital Transformation",
          "program": "Cloud Migration",
          "project": "Application Modernization",
          "projectManager": "Lisa Rodriguez",
          "g0Date": "01/05/2024",
          "g5Date": "30/09/2024",
          "prevG5Date": "15/09/2024",
          "projectStatus": "Delayed"
        },
        {
          "portfolio": "Digital Transformation",
          "program": "Security Enhancement",
          "project": "Zero Trust Implementation",
          "projectManager": "David Kim",
          "g0Date": "01/02/2024",
          "g5Date": "31/05/2024",
          "prevG5Date": "15/05/2024",
          "projectStatus": "Completed"
        },
        {
          "portfolio": "Customer Experience",
          "program": "Mobile App Development",
          "project": "iOS App Redesign",
          "projectManager": "Emma Wilson",
          "g0Date": "01/01/2024",
          "g5Date": "30/04/2024",
          "prevG5Date": "15/04/2024",
          "projectStatus": "Completed"
        },
        {
          "portfolio": "Customer Experience",
          "program": "Mobile App Development",
          "project": "Android App Redesign",
          "projectManager": "James Lee",
          "g0Date": "01/02/2024",
          "g5Date": "31/05/2024",
          "prevG5Date": "15/05/2024",
          "projectStatus": "On Track"
        }
      ],
      "transform": [
        {
          "type": "formula",
          "as": "g0DateParsed",
          "expr": "datetime(datum.g0Date)"
        },
        {
          "type": "formula", 
          "as": "g5DateParsed",
          "expr": "datetime(datum.g5Date)"
        },
        {
          "type": "formula",
          "as": "prevG5DateParsed", 
          "expr": "datum.prevG5Date ? datetime(datum.prevG5Date) : null"
        },
        {
          "type": "formula",
          "as": "duration",
          "expr": "datum.g5DateParsed - datum.g0DateParsed"
        }
      ]
    },
    {
      "name": "xExt",
      "source": "dataset",
      "transform": [
        {
          "type": "extent",
          "field": "g0DateParsed",
          "signal": "xExtSignal"
        }
      ]
    },
    {
      "name": "yScale",
      "source": "dataset",
      "transform": [
        {
          "type": "aggregate",
          "groupby": ["portfolio", "program", "project"],
          "fields": ["portfolio", "program", "project"],
          "ops": ["distinct", "distinct", "distinct"]
        },
        {
          "type": "window",
          "sort": [{"field": "portfolio"}, {"field": "program"}, {"field": "project"}],
          "frame": [null, null]
        }
      ]
    }
  ],
  "scales": [
    {
      "name": "x",
      "type": "time",
      "domain": {"signal": "xDom"},
      "range": [{"signal": "columnsWidth"}, {"signal": "width"}]
    },
    {
      "name": "y",
      "type": "band",
      "domain": {"data": "yScale", "field": "project"},
      "range": [{"signal": "yRange[0]"}, {"signal": "yRange[1]"}],
      "padding": {"signal": "yPaddingInner"}
    },
    {
      "name": "color",
      "type": "ordinal",
      "domain": ["On Track", "At Risk", "Delayed", "Completed", "Not Started"],
      "range": ["#27ae60", "#f39c12", "#e74c3c", "#3498db", "#95a5a6"]
    }
  ],
  "axes": [
    {
      "orient": "top",
      "scale": "x",
      "title": "Project Timeline",
      "titleColor": {"signal": "textColour"},
      "titleFontSize": 14,
      "titleFontWeight": "bold",
      "titlePadding": 10,
      "tickColor": {"signal": "gridColor"},
      "domainColor": {"signal": "gridColor"},
      "labelColor": {"signal": "textColour"},
      "labelFontSize": 11,
      "grid": true,
      "gridColor": {"signal": "gridColor"},
      "gridOpacity": 0.5
    }
  ],
  "marks": [
    {
      "type": "rect",
      "name": "background",
      "encode": {
        "enter": {
          "width": {"signal": "width"},
          "height": {"signal": "height"},
          "fill": {"signal": "backgroundColor"}
        }
      }
    },
    {
      "type": "rect",
      "name": "columnHeaders",
      "encode": {
        "enter": {
          "width": {"signal": "columnsWidth"},
          "height": {"signal": "height"},
          "fill": {"value": "#f8f9fa"},
          "stroke": {"signal": "gridColor"},
          "strokeWidth": {"value": 1}
        }
      }
    },
    {
      "type": "text",
      "name": "portfolioHeader",
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "Portfolio"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text", 
      "name": "programHeader",
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "Program"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "projectHeader", 
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "Project"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "managerHeader",
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "Manager"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "g0Header",
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "G0 Date"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "g5Header",
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth + g5DateColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "G5 Date"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "prevG5Header",
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth + g5DateColumnWidth + prevG5DateColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "Prev G5"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "text",
      "name": "statusHeader",
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth + g5DateColumnWidth + prevG5DateColumnWidth + statusColumnWidth/2"},
          "y": {"value": 25},
          "text": {"value": "Status"},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"}
        }
      }
    },
    {
      "type": "rect",
      "name": "rowBackgrounds",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "y": {"scale": "y", "field": "project"},
          "height": {"signal": "yRowHeight"},
          "fill": {"value": "#ffffff"},
          "stroke": {"signal": "gridColor"},
          "strokeWidth": {"value": 0.5}
        }
      }
    },
    {
      "type": "text",
      "name": "portfolioLabels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2"},
          "text": {"field": "portfolio"},
          "fontSize": {"value": 11},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "programLabels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2"},
          "text": {"field": "program"},
          "fontSize": {"value": 11},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "projectLabels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2"},
          "text": {"field": "project"},
          "fontSize": {"value": 11},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "managerLabels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2"},
          "text": {"field": "projectManager"},
          "fontSize": {"value": 11},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "g0Labels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2"},
          "text": {"field": "g0Date"},
          "fontSize": {"value": 10},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "g5Labels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth + g5DateColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2"},
          "text": {"field": "g5Date"},
          "fontSize": {"value": 10},
          "fill": {"signal": "textColour"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "text",
      "name": "prevG5Labels",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth + g5DateColumnWidth + prevG5DateColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2"},
          "text": {"field": "prevG5Date"},
          "fontSize": {"value": 10},
          "fill": {"signal": "textColourLight"},
          "textAnchor": {"value": "middle"},
          "align": {"value": "center"}
        }
      }
    },
    {
      "type": "rect",
      "name": "statusIndicators",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"signal": "portfolioColumnWidth + programColumnWidth + projectColumnWidth + managerColumnWidth + g0DateColumnWidth + g5DateColumnWidth + prevG5DateColumnWidth + statusColumnWidth/2"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yRowHeight/2"},
          "width": {"value": 12},
          "height": {"value": 12},
          "fill": {"scale": "color", "field": "projectStatus"},
          "stroke": {"signal": "textColour"},
          "strokeWidth": {"value": 1},
          "cornerRadius": {"value": 2}
        }
      }
    },
    {
      "type": "rect",
      "name": "ganttBars",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"scale": "x", "field": "g0DateParsed"},
          "y": {"scale": "y", "field": "project"},
          "dy": {"signal": "yPaddingInner/2"},
          "height": {"signal": "yRowHeight - yPaddingInner"},
          "fill": {"scale": "color", "field": "projectStatus"},
          "stroke": {"signal": "textColour"},
          "strokeWidth": {"value": 1},
          "cornerRadius": {"value": 3}
        },
        "update": {
          "width": {"scale": "x", "field": "duration", "band": 1}
        }
      }
    },
    {
      "type": "rule",
      "name": "todayLine",
      "encode": {
        "enter": {
          "x": {"scale": "x", "signal": "today"},
          "y": {"value": 0},
          "y2": {"signal": "height"},
          "stroke": {"value": "#e74c3c"},
          "strokeWidth": {"value": 2},
          "strokeDash": {"value": [5, 5]},
          "opacity": {"signal": "showTodayLine ? 0.8 : 0"}
        }
      }
    },
    {
      "type": "text",
      "name": "todayLabel",
      "encode": {
        "enter": {
          "x": {"scale": "x", "signal": "today"},
          "y": {"value": 15},
          "text": {"signal": "'Today: ' + todayRule"},
          "fontSize": {"value": 10},
          "fill": {"value": "#e74c3c"},
          "textAnchor": {"value": "middle"},
          "opacity": {"signal": "showTodayLine ? 0.8 : 0"}
        }
      }
    }
  ]
} 